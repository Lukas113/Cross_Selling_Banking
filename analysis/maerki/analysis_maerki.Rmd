```{r child = '../header.Rmd'}
```

```{r}
library(ggplot2)
source('../helpers/prepareData.R')
```


### Karten

```{r echo=FALSE}
data_all_card_count <- get_all_card_count()
print(data_all_card_count)
```
Insgesamt sind 892 Kreditkarten im Umlauf.


```{r echo=FALSE}
data_card_count_by_card_type <- get_card_count_by_card_type()
ggplot(data_card_count_by_card_type, aes(x=type, y=count)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label=count), vjust=0)
```


```{r echo=FALSE}
data_distinct_accounts_by_card <- get_distinct_accounts_by_card()
print(data_distinct_accounts_by_card)
```
Kein Konto hat mehrere Kreditkarten. (892 verschiedene Konten)

```{r echo=FALSE}
data_card_count_by_disp_type <- get_card_count_by_disp_type()
ggplot(data_card_count_by_disp_type, aes(x=type, y=count)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label=count), vjust=0)
```

Alle Kartenbesitzer sind auch Inhaber der entsprechenden Konten.  Aus der Beschreibung der Daten geht jedoch hervor, dass es erlaubt ist, mehrere Karten pro Konto zu besitzen: «more credit cards can be issued to an account». Ein zusätzliches Business könnte also sein, weitere Kreditkarten für die selben Konten an Disponenten zu vergeben.

```{r echo=FALSE}
data_months_until_cards_issued <- get_months_until_cards_issued()
head(data_months_until_cards_issued)
```




#### Client

```{r echo=FALSE}
data_count_by_gender <- get_count_by_gender()
head(data_count_by_gender)
```
Die Verteilung der Frauen und Männer ist repräsentativ.

```{r echo=FALSE}
dataAge = dbGetQuery(con, "SELECT
	EXTRACT(YEAR FROM AGE('1998-12-31', CASE WHEN MOD(birth_number / 100, 100) > 50 THEN TO_DATE(CONCAT('19', CAST(birth_number-5000 AS VARCHAR(6))), 'YYYYMMDD') ELSE TO_DATE(CONCAT('19', CAST(birth_number AS VARCHAR(6))), 'YYYYMMDD') END)) as age,
	count(EXTRACT(YEAR FROM AGE('1998-12-31', CASE WHEN MOD(birth_number / 100, 100) > 50 THEN TO_DATE(CONCAT('19', CAST(birth_number-5000 AS VARCHAR(6))), 'YYYYMMDD') ELSE TO_DATE(CONCAT('19', CAST(birth_number AS VARCHAR(6))), 'YYYYMMDD') END)))
FROM client
group by age")

library(ggplot2)
ggplot(data = dataAge) + 
  geom_point(mapping = aes(x = age, y = count)) + scale_x_continuous(breaks = c(10,20,30,40,50,60,70,80,90))
```

```{r echo=FALSE}
dataCard = dbGetQuery(con, "SELECT type, count(type) FROM card group by type")
head(dataCard)
```


```{r child = '../footer.Rmd'}
```