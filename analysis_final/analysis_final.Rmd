---
title: "Analyse zu «HS19C2 - Cross-Selling in Banking»"
author:
  - Lukas Gehrig, Simon Stähli, Lukas Märki
date: "`r format(Sys.time(), '%d.%m.%Y')`"
output:
  html_document:
    df_print: paged
    css: style.css
  pdf_document: default
---

```{r message=FALSE, echo=FALSE}
source('inc/header.R')
```

Aufgabestellung, etc.  
Kunde: Prof. Dr. Daniel Perruchoud

# 1. Qualität und Representativität der Daten

In den Daten sind alle Konten enthalten, welche im Zeitraum von 1.1.1993 bis 29.12.1997 eröffnet worden sind. Insgesamt sind 4'500 Konten in diesem Zeitraum eröffnet worden.  
Die Daten der getätigten Transaktionen und Ausstelldaten der Kreditkarten reichen von 1993 bis zum Ende von 1998. Es scheint unwahrscheinlich, dass im Jahr 1998 keine weiteren Konten eröffnet worden sind. Es ist anzunehmen, dass die Daten über die Konten von 1998 nicht veröffentlicht worden sind.

## Kumulierte Anzahl Konten von 1.1.1993 bis 29.12.1997
```{r echo=FALSE}
data_accounts_running_total <- get_accounts_running_total()
ggplot(data_accounts_running_total, aes(x=date, y=accounts_running_total)) +
  geom_line() +
  labs(x="Jahre", y="Kumulierte Anzahl Konten")
```

Auffallend in der kumulierten Anzahl der Konten welche eröffnet wurden ist, dass der Zuwachs zwischen 1994 und 1997 unstetig ist. Zwischen 1994 und 1996 nimmt der Zuwach deutlich ab, wohin gegen mehr Konten im Jahr 1996 eröffnet wurden, als in den Jahren 1993 und 1997.

## Anteil Kunden pro Geschlecht
```{r echo=FALSE}
data_count_by_gender <- get_count_by_gender()
ggplot(data_count_by_gender, aes(x=gender, y=count)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label=count), vjust=-0.5)
```

Die Verteilung der Frauen und Männer ist repräsentativ. Frauen machen 49.26 % und die Männer 50.74 % aller Kunden aus.

# 2. Datenbasis

## Verteilung aller Kunden pro Alter (Stichtag: 31.12.1998)
```{r echo=FALSE}
data_all_clients_age <- get_all_clients_age()
ggplot(data_all_clients_age, aes(x=age)) + 
  geom_histogram(binwidth=5) +
  scale_x_continuous(breaks = seq(0, 100, 10)) +
  labs(x='Alter', y='Anzahl')
```

Der grösste Anteil aller Kunden liegt im Alter zwischen 18 und 63 Jahre.

# Districts
- S: Amount of Customers per Region with cards
- S: Altersverteilung nach Regione Facets

# Accounts

## Vergleich Accounts mit owner gegenüber owner und disponent
```{r echo=FALSE}
data_owner_disp <- get_owner_disp()

data_owner_disp %>%
  ggplot(aes(x = count_users)) + 
  geom_bar(fill = "lightblue", color = "black") +
  geom_text(stat = "count", aes(label = ..count.. , vjust = -0.5) ) +
  ylab(label = "amount") +
  scale_x_continuous(breaks = c(1,2), labels = c("OWNER", "OWNER, DISPONENT"))
```

Man sieht, dass kein Konto mehr als ein Disponent hat.

- S: Accounts mit Loans / ohne Loans
- M: Line Plot mit den Summierungen von Accounts
- G: Vermögen 98'

# Loans
- G: Beweis Account nur ein loan
- S: Übersicht Loans mit Status
- S: Loans über Jahr mit binwidth = 3
- S: Loan amount on card type: Wenig Daten, vorsicht lieber Simon.
- S: Loan auf Geschlecht, Loan status. Das farbige.
- S: Loan Altersverteiung Timeframe, Alter zu Loan Ausstelldatum

# Karten
- S: Number of counts for each service construct

# Trans
- G: Genauigkeitsüberprüfung
- G: Analyse fehlende Werte
- G: Warum VYBER?

# 5. Kreditkarten

## Anzahl Karten pro Kartentyp
```{r echo=FALSE}
data_card_count_by_card_type <- get_card_count_by_card_type()
ggplot(data_card_count_by_card_type, aes(x=type, y=count)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label=count), vjust=-0.5)
```

Insgesamt sind 892 Kreditkarten im Umlauf:

* 659 Classic
* 145 Junior
* 88 Gold.

## Verteilung der Kreditkarten pro Account und Disponent
```{r echo=FALSE}
data_distinct_accounts_by_card <- get_distinct_accounts_by_card()
ggplot(data_distinct_accounts_by_card, aes(x=accounts, y=count)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label=count), vjust=-0.5)
```

Kein Konto hat mehrere Kreditkarten. (892 verschiedene Konten)

```{r echo=FALSE}
data_card_count_by_disp_type <- get_card_count_by_disp_type()
ggplot(data_card_count_by_disp_type, aes(x=type, y=count)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label=count), vjust=-0.5)
```

Alle Kartenbesitzer sind auch Inhaber (Owner) der entsprechenden Konten.  Aus der Beschreibung der Daten geht jedoch hervor, dass es erlaubt ist, mehrere Karten pro Konto zu besitzen: «more credit cards can be issued to an account».  
Ein zusätzliches Business könnte also sein, weitere Kreditkarten für die selben Konten an Disponenten zu vergeben.  
Hier ist zuerst mit der Bank zu prüfen, ob es einen Grund gibt, warum dies nicht bereits so gehandhabt wurde.

## Altersverteilung beim Ausstelldatum der Kreditkarte.
```{r echo=FALSE}
data_client_age_by_issued_date <- get_client_age_by_issued_date()

ggplot(data = data_client_age_by_issued_date, mapping = aes(x = age_on_card_issue, color=type)) +
  geom_freqpoly(binwidth=4)
```

Gemäss den Daten wird die Junior-Kreditkarte nur an unter 25 Jährige vergeben.
Da laut den Daten 55 Kunden unter 18 Jahren sind welche eine Kreditkarte erhalten haben, scheint es erlaubt zu sein, Kreditkarten an nicht volljährige Personen zu vergeben.

```{r echo=FALSE}
data_client_age_by_issued_date <- get_client_age_by_issued_date()
data_clients_without_credit_card_0_100 <- get_clients_without_credit_card_by_age_range(0, 100)

ggplot() +
  geom_freqpoly(data = data_client_age_by_issued_date, mapping = aes(x = age_on_card_issue), binwidth=4, color="blue") +
  geom_freqpoly(data = data_clients_without_credit_card_0_100, mapping = aes(x = age), binwidth=4, color="red") +
  xlab('Alter') +
  ylab('Anzahl') +
  scale_x_continuous(breaks = seq(10,90,5))
```

Die blaue Linie ist das Alter der Kunden bei ausstellung der Kreditkarte. Die rote Linie sind alle Kunden und Alter welche keine Kreditkarte haben zum Stichtag 31.12.1998.

Da ausgestellte Kreditkarten ab 55-jährige rasant abnimmt, macht es keinen Sinn, über 55 Jährige die Kreditkarte zu bewerben.

## Kunden ohne Kreditkarten

Insgesamt gibt es 514 Clients welche Besitzer (owner) eines Accounts sind, welche keine Kreditkarte besitzen und unter 25 Jahre sind. Dies wären potentielle Kunden für die Junior-Kreditkarte.  
Die ersten 6:
```{r echo=FALSE}
data_clients_wihtout_credit_card_by_age_range_0_25 <- get_clients_without_credit_card_by_age_range(0, 25)
head(data_clients_wihtout_credit_card_by_age_range_0_25)
```

Insgesamt gibt es 3094 Clients welche Besitzer (owner) eines Accounts sind, welche keine Kreditkarte besitzen und über 24 Jahre sind.  
Die ersten 6:

```{r echo=FALSE}
data_clients_wihtout_credit_card_by_age_range_24_100 <- get_clients_without_credit_card_by_age_range(24, 100)
head(data_clients_wihtout_credit_card_by_age_range_24_100)
```

```{r echo=FALSE}
disconnect()
```

